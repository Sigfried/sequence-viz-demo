<!doctype html>
<html>
<head>
    <title>Timelines Test Page</title>
    <link rel="stylesheet" href="./test/jasmine2.css">
    <script> var testPage = 'nvd3';</script>
    <script src="./test/jasmine2.js"></script>
    <script src="./test/jasmine2-html.js"></script>
    <script src="./test/jasmine2-boot.js"></script>
    <script src="/testem.js"></script>

    <script src="./node_modules/d3/d3.js"></script>
    <script src="./node_modules/nvd3/nv.d3.js"></script>
    <link href="./bower_components/nvd3/src/nv.d3.css" rel="stylesheet" type="text/css">
    <link href="./menu.css" rel="stylesheet" type="text/css">
    <script src="./test-timelines-nvd3-bundle.js"></script>
    <script src="./timelinesChart.js"></script>
    <script src="./timelines.js"></script>
    <script>
        var _ = seqViz.supergroup;
    </script>

    <style>
        svg#main { padding-top: 70px; }
    </style>

</head>
<body>
    <script>
        /*
        var reporter = new jasmine.HtmlReporter
        //var reporter = new jasmine.TrivialReporter
            , env = jasmine.getEnv();
        env.specFilter = function(spec){
            return reporter.specFilter(spec)
        }
        env.addReporter(reporter)
        env.execute()
        */
        var firstTime = true;
        var holdChart;
        function makeChart(bucket) {
            if (firstTime) {
                firstTime = false;
                nv.addGraph(
                    function() {
                        var chart = nv.models.timelinesChart()
                        bucket.container.data(bucket.timelines)
                            .transition().duration(500).call(chart);

                        nv.utils.windowResize(chart.update);
                        chart.timelines.dispatch.on("timelinesMouseover",
                            function(lfChart, domNode, lfnode, i) {
                                var gNode = domNode.parentNode; // event is on the rect now
                                extras.showEvtDistribution(lfChart, gNode,
                                    lfnode, i);
                                //extras.nodeTooltip(lfChart, gNode, lfnode, i);
                                extras.nodeDumpTooltip(lfChart, gNode, lfnode, i);
                            });
                        extras.dispatch.on('distNodeMouseover', extras.distNodeTooltip);
                            //function(chrt, domNode, lfNode, i) { alert(d); };
                        chart.timelines.dispatch.on("timelinesMouseout", nv.tooltip.cleanup);
                        return chart;
                    }, 
                    function(chart) {
                        holdChart = bucket.chart = chart;
                        bucket.done();
                    }
                );
            } else {
                bucket.chart = holdChart;
                bucket.done();
            }
        };
        //jasmine.getEnv().execute();

    </script>
</body>
</html>
