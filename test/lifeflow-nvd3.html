<!doctype html>
<html>
<head>
    <title>My Test Page</title>
    <link rel="stylesheet" href="./test/jasmine.css">
    <script> var testPage = 'nvd3';</script>
    <script src="./test/jasmine.js"></script>
    <script src="/testem.js"></script>
    <script src="./test/jasmine-html.js"></script>

    <link href="./nvd3/src/nv.d3.css" rel="stylesheet" type="text/css">
    <link href="./menu.css" rel="stylesheet" type="text/css">

    <style>
        svg#main { padding-top: 70px; }
    </style>

    <script src="./sequence-viz/bower_components/d3/d3.js"></script>
    <script src="./sequence-viz/bower_components/underscore/underscore.js"></script>
    <script src="./sequence-viz/bower_components/1670507/underscoreAddon.js"></script>
    <script src="./sequence-viz/bower_components/momentjs/moment.js"></script>
    <script src="./underscore-unchained/underscore-unchained.js"></script>
    <script src="./supergroup/supergroup.js"></script>
    <script src="./sequence-viz/evtData.js"></script>
    <script src="./sequence-viz/lifeflowData.js"></script>
    <script src="./sequence-viz/lifeflow.js"></script>
    <script src="./sequence-viz/timelines.js"></script>
    <script src="./sequence-viz/lifeflowExtras.js"></script>

    <script src="./nvd3/nv.d3.js"></script>
    <script src="./nvd3/src/models/axis.js"></script>
    <script src="./nvd3/src/models/lifeflow.js"></script>
    <script src="./nvd3/src/models/lifeflowChart.js"></script>

    <script src="./test/sequence-viz-demo-spec.js"></script>
    <script src="./sequence-viz/test/sequence-viz-spec.js"></script>
</head>
<body>
    <script>
        /*
        var reporter = new jasmine.HtmlReporter
        //var reporter = new jasmine.TrivialReporter
            , env = jasmine.getEnv();
        env.specFilter = function(spec){
            return reporter.specFilter(spec)
        }
        env.addReporter(reporter)
        env.execute()
        */
        var eventNodeWidth = 10;  // pixels now
        // need to do eventNodeWidth in pixels, not time units!!!!!
        var alignmentLineWidth = 1 * 1000 * 60 * 60 * 24;
        var csv =   "id,event,date\n" +
                    "1,A,1/1/1950\n" +
                    "1,B,3/2/1950\n" +
                    "1,B,3/12/1950\n" +
                    "2,A,1/1/1960\n" +
                    "2,B,1/16/1960\n" +
                    "2,C,3/31/1960\n" +
                    "2,B,6/29/1960\n" +
                    "3,B,1/1/1970\n" +
                    "3,A,1/11/1970\n" +
                    "3,B,5/11/1970\n" +
                    "3,B,6/10/1970\n";
        var data = d3.csv.parse(csv);
        var eventOrder = ['A','B','C'];
        var stuff = {};
        stuff.edata = evtData()
                .entityIdProp('id')
                .eventNameProp('event')
                .startDateProp('date')
        stuff.timelines = stuff.edata.makeTimelines(data);
        stuff.timelines.timelineUnit('day');
        stuff.startRecs = stuff.timelines
                            .pluck('records')
                            .map(_.first);
        stuff.nodeTree = lifeflowData()
                .eventNameProp('event')
                .timelines(stuff.timelines)
                (stuff.startRecs, 'noflatten');
        stuff.nodeList = stuff.nodeTree.flattenTree();
        stuff.container = d3.select('body')
                        .append('div')
                            .style('height','100%')
                        .append('svg')

        nv.addGraph(function() {
            var chart = nv.models.lifeflowChart()
                        .eventNodeWidth(eventNodeWidth);

            chart.xAxis
                .tickFormat(function(d) { return d3.time.format('%x')(new Date(d)) });

            chart.yAxis
                .tickFormat(d3.format(','));


            stuff.container.datum(stuff.nodeList)
                .transition().duration(500).call(chart);

            nv.utils.windowResize(chart.update);

            return chart;
        });
        stuff.chart = nv.models.lifeflowChart();

        jasmine.getEnv().execute();

    </script>
</body>
</html>
